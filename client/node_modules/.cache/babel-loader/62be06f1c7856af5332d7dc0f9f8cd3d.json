{"ast":null,"code":"/*\n * Copyright (C) 2016 Bilibili. All Rights Reserved.\n *\n * This file is derived from C++ project libWinTF8 (https://github.com/m13253/libWinTF8)\n * @author zheng qian <xqq@xqq.im>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction checkContinuation(uint8array, start, checkLength) {\n  let array = uint8array;\n\n  if (start + checkLength < array.length) {\n    while (checkLength--) {\n      if ((array[++start] & 0xC0) !== 0x80) return false;\n    }\n\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction decodeUTF8(uint8array) {\n  let out = [];\n  let input = uint8array;\n  let i = 0;\n  let length = uint8array.length;\n\n  while (i < length) {\n    if (input[i] < 0x80) {\n      out.push(String.fromCharCode(input[i]));\n      ++i;\n      continue;\n    } else if (input[i] < 0xC0) {// fallthrough\n    } else if (input[i] < 0xE0) {\n      if (checkContinuation(input, i, 1)) {\n        let ucs4 = (input[i] & 0x1F) << 6 | input[i + 1] & 0x3F;\n\n        if (ucs4 >= 0x80) {\n          out.push(String.fromCharCode(ucs4 & 0xFFFF));\n          i += 2;\n          continue;\n        }\n      }\n    } else if (input[i] < 0xF0) {\n      if (checkContinuation(input, i, 2)) {\n        let ucs4 = (input[i] & 0xF) << 12 | (input[i + 1] & 0x3F) << 6 | input[i + 2] & 0x3F;\n\n        if (ucs4 >= 0x800 && (ucs4 & 0xF800) !== 0xD800) {\n          out.push(String.fromCharCode(ucs4 & 0xFFFF));\n          i += 3;\n          continue;\n        }\n      }\n    } else if (input[i] < 0xF8) {\n      if (checkContinuation(input, i, 3)) {\n        let ucs4 = (input[i] & 0x7) << 18 | (input[i + 1] & 0x3F) << 12 | (input[i + 2] & 0x3F) << 6 | input[i + 3] & 0x3F;\n\n        if (ucs4 > 0x10000 && ucs4 < 0x110000) {\n          ucs4 -= 0x10000;\n          out.push(String.fromCharCode(ucs4 >>> 10 | 0xD800));\n          out.push(String.fromCharCode(ucs4 & 0x3FF | 0xDC00));\n          i += 4;\n          continue;\n        }\n      }\n    }\n\n    out.push(String.fromCharCode(0xFFFD));\n    ++i;\n  }\n\n  return out.join('');\n}\n\nexport default decodeUTF8;","map":null,"metadata":{},"sourceType":"module"}